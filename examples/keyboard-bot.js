/**
 * keyboard-bot
 */
const Telegraf = require('telegraf')
const { Extra, Markup } = require('telegraf')

module.exports = () => {
  const bot = new Telegraf(process.env.BOT_TOKEN)

  //–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∞ –¥–ª—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  bot.use(Telegraf.log())

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã onetime:
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'One time keyboard',
  //–æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ç—Ä–µ–º—è –∫–Ω–æ–ø–∫–∞–º–∏
  bot.command('onetime', ({ reply }) =>
    reply('One time keyboard', Markup
      .keyboard(['/simple', '/inline', '/pyramid'])
      .oneTime()
      .resize()
      .extra()
    )
  )

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã custom:
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'Custom buttons keyboard',
  //–æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Å–µ–º—å—é –∫–Ω–æ–ø–∫–∞–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É —Ç—Ä–µ–º—è —Å—Ç—Ä–æ–∫–∞–º–∏: –¥–≤–µ
  //–≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ, –¥–≤–µ - –≤–æ –≤—Ç–æ—Ä–æ–π –∏ —Ç—Ä–∏ - –≤ —Ç—Ä–µ—Ç—å–µ–π
  bot.command('custom', ({ reply }) => {
    return reply('Custom buttons keyboard', Markup
      .keyboard([
        ['üîç Search', 'üòé Popular'],         // Row1 with 2 buttons
        ['‚ò∏ Setting', 'üìû Feedback'],       // Row2 with 2 buttons
        ['üì¢ Ads', '‚≠êÔ∏è Rate us', 'üë• Share'] // Row3 with 3 buttons
      ])
      .oneTime()
      .resize()
      .extra()
    )
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã special
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'Special buttons keyboard',
  //–æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏:
  //–∫–Ω–æ–ø–∫–∞–º–∏, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∞—è –∫–æ–Ω—Ç–∞–∫—Ç—ã,
  //–∫–Ω–æ–ø–∫–∞, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∞—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
  bot.command('special', (ctx) => {
    //–º–µ—Ç–æ–¥ Extra.markup –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Markup
    return ctx.reply('Special buttons keyboard', Extra.markup((markup) => {
      return markup.resize()
        .keyboard([
          markup.contactRequestButton('Send contact'),
          markup.locationRequestButton('Send location')
        ])
    }))
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã pyramid
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'Keyboard wrap',
  //–æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —à–µ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∞–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É —Ç—Ä–µ–º—è —Å—Ç—Ä–æ–∫–∞–º–∏:
  //–æ–¥–Ω–∞ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ, –¥–≤–µ - –≤–æ –≤—Ç–æ—Ä–æ–π –∏ —Ç—Ä–∏ - –≤ —Ç—Ä–µ—Ç—å–µ–π.
  bot.command('pyramid', (ctx) => {
    //–º–µ—Ç–æ–¥ Extra.markup –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Markup –∏ –æ–±—ä–µ–∫—Ç —Å
    //–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º wrap)
    return ctx.reply('Keyboard wrap', Extra.markup(
      Markup.keyboard(['one', 'two', 'three', 'four', 'five', 'six'], {
        //btn - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏,
        //index - –∏–Ω–¥–µ–∫—Å –∫–Ω–æ–ø–∫–∏,
        //currentRow - –º–∞—Å—Å–∏–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –Ω–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
        //–µ—Å–ª–∏ –º–µ—Ç–æ–¥ wrap –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false, —Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏
        //–æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, —Ç–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ
        wrap: (btn, index, currentRow) => currentRow.length >= (index + 1) / 2
      })
    ))
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã simple
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ —É–∫–∞–∑–∞–Ω–Ω—ã–π HTML-–∫–æ–¥, –¥–æ–±–∞–≤–∏–≤ –∫ –Ω–µ–º—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å
  //–¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏
  bot.command('simple', (ctx) => {
    return ctx.replyWithHTML('<b>Coke</b> or <i>Pepsi?</i>', Extra.markup(
      Markup.keyboard(['Coke', 'Pepsi'])
    ))
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã inline
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ —É–∫–∞–∑–∞–Ω–Ω—ã–π HTML-–∫–æ–¥, –¥–æ–±–∞–≤–∏–≤ –∫ –Ω–µ–º—É –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é
  //–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏, –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–∞–∂–¥—É—é –∏–∑ –∫–Ω–æ–ø–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
  //—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ
  bot.command('inline', (ctx) => {
    return ctx.reply('<b>Coke</b> or <i>Pepsi?</i>', Extra.HTML().markup((m) =>
      m.inlineKeyboard([
        //–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Coke
        m.callbackButton('Coke', 'Coke'),
        //–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Pepsi
        m.callbackButton('Pepsi', 'Pepsi')
      ])))
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã random
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'random example', –¥–æ–±–∞–≤–∏–≤ –∫ –Ω–µ–º—É –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å
  // –¥–≤—É–º—è/—Ç—Ä–µ–º—è –∫–Ω–æ–ø–∫–∞–º–∏
  bot.command('random', (ctx) => {
    return ctx.reply('random example',
      Markup.inlineKeyboard([
        //–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Coke
        Markup.callbackButton('Coke', 'Coke'),
        //–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Dr Pepper
        //—Ç—Ä–µ—Ç—å–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –º–µ—Ç–æ–¥ callbackButton –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç,
        //–æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –∏–ª–∏ –Ω–µ—Ç
        Markup.callbackButton('Dr Pepper', 'Dr Pepper', Math.random() > 0.5),
        //–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Pepsi
        Markup.callbackButton('Pepsi', 'Pepsi')
      ]).extra()
    )
  })

  //–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è '/wrap <–æ–¥–Ω–∞ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä>'
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ 'Keyboard wrap',
  //–æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —à–µ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∞–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É —É–∫–∞–∑–∞–Ω–Ω—ã–º
  //–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å—Ç–æ–ª–±—Ü–æ–≤
  bot.hears(/\/wrap (\d+)/, (ctx) => {
    return ctx.reply('Keyboard wrap', Extra.markup(
      Markup.keyboard(['one', 'two', 'three', 'four', 'five', 'six'], {
        //—Å–≤–æ–π—Å—Ç–≤–æ columns —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤
        columns: parseInt(ctx.match[1])
      })
    ))
  })

  //–ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è Dr Pepper
  //–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–º–∞–π–ª–∏–∫–æ–º
  bot.action('Dr Pepper', (ctx, next) => {
    return ctx.reply('üëç').then(next)
  })

  //–ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª—é–±–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
  //–≤—ã–≤–æ–¥–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º 'Oh, <choice>! Great choise'
  bot.action(/.+/, (ctx) => {
    return ctx.answerCallbackQuery(`Oh, ${ctx.match[0]}! Great choise`)
  })

  bot.startPolling()
}
